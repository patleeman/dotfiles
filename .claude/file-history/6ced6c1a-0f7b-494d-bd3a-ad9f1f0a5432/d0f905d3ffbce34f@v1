import { test, expect } from './fixtures/test-fixtures';

test.describe('Navigation', () => {
  test('should load the dashboard on root route', async ({ page }) => {
    await page.goto('/');
    await expect(page).toHaveURL('/');
    // Dashboard should be visible
    await expect(page.locator('body')).toBeVisible();
  });

  test('should navigate to settings page via command bar', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+k');
    await page.waitForTimeout(300);

    // Type "settings" to filter commands
    await page.keyboard.type('settings');
    await page.waitForTimeout(200);

    // Press enter to navigate
    await page.keyboard.press('Enter');
    await expect(page).toHaveURL('/settings');
  });

  test('should navigate to skills page via command bar', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+k');
    await page.waitForTimeout(300);

    await page.keyboard.type('skills');
    await page.waitForTimeout(200);
    await page.keyboard.press('Enter');
    await expect(page).toHaveURL('/skills');
  });

  test('should navigate to triggers page via command bar', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+k');
    await page.waitForTimeout(300);

    await page.keyboard.type('triggers');
    await page.waitForTimeout(200);
    await page.keyboard.press('Enter');
    await expect(page).toHaveURL('/triggers');
  });

  test('should navigate to usage page via command bar', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+k');
    await page.waitForTimeout(300);

    await page.keyboard.type('usage');
    await page.waitForTimeout(200);
    await page.keyboard.press('Enter');
    await expect(page).toHaveURL('/usage');
  });

  test('should open command bar with Cmd+K', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+k');
    // Command bar/search should be visible
    await expect(page.getByPlaceholder(/search|command/i)).toBeVisible();
  });

  test('should close command bar with Escape', async ({ page }) => {
    await page.goto('/');
    await page.keyboard.press('Meta+k');
    await expect(page.getByPlaceholder(/search|command/i)).toBeVisible();
    await page.keyboard.press('Escape');
    await expect(page.getByPlaceholder(/search|command/i)).not.toBeVisible();
  });

  test('should navigate back to dashboard from settings', async ({ page }) => {
    await page.goto('/settings');
    await page.keyboard.press('Meta+k');
    await page.waitForTimeout(300);

    await page.keyboard.type('dashboard');
    await page.waitForTimeout(200);
    await page.keyboard.press('Enter');
    await expect(page).toHaveURL('/');
  });
});

test.describe('URL Routing', () => {
  test('should load settings page directly', async ({ page }) => {
    await page.goto('/settings');
    await expect(page.locator('text=Provider Configuration')).toBeVisible();
  });

  test('should load skills page directly', async ({ page }) => {
    await page.goto('/skills');
    // Skills header should be visible (may be uppercase)
    await expect(page.locator('text=skills').or(page.locator('text=Skills'))).toBeVisible();
  });

  test('should load triggers page directly', async ({ page }) => {
    await page.goto('/triggers');
    // Triggers header should be visible (may be uppercase)
    await expect(page.locator('text=triggers').or(page.locator('text=Triggers'))).toBeVisible();
  });

  test('should load usage page directly', async ({ page }) => {
    await page.goto('/usage');
    await expect(page.locator('text=Resource Usage')).toBeVisible();
  });
});
