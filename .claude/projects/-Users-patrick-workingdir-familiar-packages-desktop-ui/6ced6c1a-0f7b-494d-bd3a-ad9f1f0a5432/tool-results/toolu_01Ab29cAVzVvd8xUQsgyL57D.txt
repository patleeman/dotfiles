     1→import React, { useState, useEffect } from 'react';
     2→import { clsx } from 'clsx';
     3→import { useAgents } from '../../context/AgentContext';
     4→import { useQuery, useQueryClient } from '@tanstack/react-query';
     5→import { api, type Skill } from '../../lib/api';
     6→import { useNavigate } from 'react-router-dom';
     7→import { ask } from '@tauri-apps/plugin-dialog';
     8→import { DropdownMenu, DropdownMenuItem, DropdownMenuSeparator } from '../ui';
     9→
    10→export const SkillsView: React.FC = () => {
    11→  const { listSkills, deleteSkill, isExplorerCollapsed, agents, createAgent, selectAgent, setSidebarCollapsed } = useAgents();
    12→  const navigate = useNavigate();
    13→  const queryClient = useQueryClient();
    14→  const [contextMenu, setContextMenu] = useState<{ x: number, y: number, skillName: string } | null>(null);
    15→  const [isCreating, setIsCreating] = useState<string | null>(null);
    16→
    17→  useEffect(() => {
    18→    const handleClick = () => setContextMenu(null);
    19→    window.addEventListener('click', handleClick);
    20→    return () => window.removeEventListener('click', handleClick);
    21→  }, []);
    22→
    23→  const handleContextMenu = (e: React.MouseEvent, skillName: string) => {
    24→    e.preventDefault();
    25→    setContextMenu({ x: e.clientX, y: e.clientY, skillName });
    26→  };
    27→
    28→  const { data: config } = useQuery({
    29→    queryKey: ['config'],
    30→    queryFn: () => api.getConfig(),
    31→  });
    32→
    33→  const { data: skillsData, isLoading: skillsLoading } = useQuery({
    34→    queryKey: ['skills'],
    35→    queryFn: async () => {
    36→      const resp = await listSkills();
    37→      return Array.isArray(resp?.skills) ? resp.skills : [];
    38→    }
    39→  });
    40→
    41→  const handleSkillClick = async (skill: Skill) => {
    42→    // Find if there's an existing Skill Architect agent for this skill
    43→    const architect = Object.values(agents).find(a =>
    44→      a.name === `Skill Architect: ${skill.name}` &&
    45→      !a.is_internal
    46→    );
    47→
    48→    if (architect) {
    49→      selectAgent(architect.id);
    50→      navigate(`/agent/${architect.id}`);
    51→      return;
    52→    }
    53→
    54→    setIsCreating(skill.name);
    55→    try {
    56→      const response = await createAgent(
    57→        { provider: config?.inference?.chat?.provider, model: config?.inference?.chat?.model },
    58→        '',
    59→        { is_skill_creator: true, skill_id: skill.name }
    60→      );
    61→      if (response && response.id) {
    62→        setSidebarCollapsed(true);
    63→        selectAgent(response.id);
    64→        navigate(`/agent/${response.id}`);
    65→      }
    66→    } catch (err) {
    67→      console.error('Failed to create skill architect:', err);
    68→    } finally {
    69→      setIsCreating(null);
    70→    }
    71→  };
    72→
    73→  const handleAction = async (name: string, action: 'edit' | 'open' | 'delete') => {
    74→    const skill = skillsData?.find((s: Skill) => s.name === name);
    75→    if (!skill) return;
    76→
    77→    switch (action) {
    78→      case 'edit':
    79→        handleSkillClick(skill);
    80→        break;
    81→      case 'open':
    82→        if (skill.path) {
    83→          try {
    84→            // Open the parent directory of the skill
    85→            const parentPath = skill.path.substring(0, skill.path.lastIndexOf('/'));
    86→            await api.openPath(parentPath);
    87→          } catch (err) {
    88→            console.error('Failed to open finder:', err);
    89→          }
    90→        }
    91→        break;
    92→      case 'delete':
    93→        const confirmed = await ask(`Are you sure you want to delete the skill "${name}"? This will permanently remove the skill files from your library. This cannot be undone.`, {
    94→          title: 'Delete Skill',
    95→          kind: 'warning',
    96→        });
    97→        if (confirmed) {
    98→          await deleteSkill(name);
    99→          queryClient.invalidateQueries({ queryKey: ['skills'] });
   100→        }
   101→        break;
   102→    }
   103→  };
   104→
   105→  return (
   106→    <div className="flex flex-col h-full bg-background font-mono text-[12px] relative overflow-hidden select-none">
   107→      {/* ... Skills Header ... */}
   108→      <div className="flex items-center justify-between px-4 py-2 border-b border-border/20 bg-surface/5 shrink-0 font-mono">
   109→        <div className="flex items-center gap-3">
   110→          <h1 className="text-[11px] font-black text-accent uppercase tracking-[0.25em]">
   111→            {isExplorerCollapsed ? 'Skills ' : null}
   112→            <span className={clsx("text-text-tertiary opacity-30 font-black", isExplorerCollapsed ? "ml-1" : "ml-0")}>
   113→              {skillsData?.length || 0} skills
   114→            </span>
   115→          </h1>
   116→        </div>
   117→
   118→        <div className="flex items-center gap-4">
   119→        </div>
   120→      </div>
   121→
   122→      <div className="flex-1 overflow-auto p-1 custom-scrollbar">
   123→        <div className="w-full font-mono">
   124→          <div className="sticky top-0 z-10 grid grid-cols-[200px_1fr] gap-2 px-4 py-1.5 bg-background border-b border-border/40 text-[9px] font-black text-text-tertiary uppercase tracking-widest shadow-sm">
   125→            <div>Skill</div>
   126→            <div>Description</div>
   127→          </div>
   128→
   129→          <div className="flex flex-col">
   130→            {skillsLoading ? (
   131→              <div className="px-4 py-12 text-center">
   132→                <div className="flex flex-col items-center gap-2 text-text-tertiary/20">
   133→                  <div className="w-6 h-6 border-2 border-current border-t-transparent rounded-full animate-spin" />
   134→                  <span className="uppercase tracking-[0.2em] text-[9px] font-black">Loading skills...</span>
   135→                </div>
   136→              </div>
   137→            ) : skillsData?.length === 0 ? (
   138→              <div className="px-4 py-12 text-center text-text-tertiary/30 uppercase tracking-[0.2em] text-[9px] font-black">
   139→                No skills found
   140→              </div>
   141→            ) : (
   142→              [...skillsData]
   143→                .sort((a, b) => (a?.name || '').localeCompare(b?.name || ''))
   144→                .map((skill: Skill) => (
   145→                  <div
   146→                    key={skill.name}
   147→                    onClick={() => handleSkillClick(skill)}
   148→                    onContextMenu={(e) => handleContextMenu(e, skill.name)}
   149→                    className={clsx(
   150→                      "grid grid-cols-[200px_1fr] gap-2 px-4 py-1 border-b border-border/5 hover:bg-surface/30 transition-all items-start group cursor-pointer",
   151→                      isCreating === skill.name && "opacity-50 pointer-events-none"
   152→                    )}
   153→                  >
   154→                    <div className="flex items-center gap-2 text-text-primary font-black uppercase tracking-tighter text-[10px]">
   155→                      {isCreating === skill.name && (
   156→                        <div className="w-2.5 h-2.5 border border-current border-t-transparent rounded-full animate-spin" />
   157→                      )}
   158→                      {skill.name}
   159→                    </div>
   160→                    <div className="text-text-secondary opacity-50 text-[10px] leading-relaxed uppercase tracking-tight font-black">
   161→                      {skill.description}
   162→                    </div>
   163→                  </div>
   164→                ))
   165→            )}
   166→          </div>
   167→        </div>
   168→      </div>
   169→
   170→      <DropdownMenu
   171→        isOpen={!!contextMenu}
   172→        onClose={() => setContextMenu(null)}
   173→        position={contextMenu ? { x: contextMenu.x, y: contextMenu.y } : { x: 0, y: 0 }}
   174→        title={contextMenu?.skillName}
   175→      >
   176→        <DropdownMenuItem
   177→          onClick={() => {
   178→            if (contextMenu) handleAction(contextMenu.skillName, 'edit');
   179→            setContextMenu(null);
   180→          }}
   181→        >
   182→          Edit
   183→        </DropdownMenuItem>
   184→
   185→        <DropdownMenuItem
   186→          onClick={() => {
   187→            if (contextMenu) handleAction(contextMenu.skillName, 'open');
   188→            setContextMenu(null);
   189→          }}
   190→        >
   191→          Open in Finder
   192→        </DropdownMenuItem>
   193→
   194→        <DropdownMenuSeparator />
   195→
   196→        <DropdownMenuItem
   197→          variant="danger"
   198→          onClick={() => {
   199→            if (contextMenu) handleAction(contextMenu.skillName, 'delete');
   200→            setContextMenu(null);
   201→          }}
   202→        >
   203→          Delete
   204→        </DropdownMenuItem>
   205→      </DropdownMenu>
   206→    </div>
   207→  );
   208→};
   209→
   210→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
