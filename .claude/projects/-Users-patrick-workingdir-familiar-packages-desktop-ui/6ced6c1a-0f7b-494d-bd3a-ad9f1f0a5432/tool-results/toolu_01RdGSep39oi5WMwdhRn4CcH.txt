     1→import { spawn, ChildProcess } from 'child_process';
     2→import { resolve } from 'path';
     3→
     4→let serverProcess: ChildProcess | null = null;
     5→
     6→async function waitForServer(url: string, timeout = 30000): Promise<void> {
     7→  const start = Date.now();
     8→  while (Date.now() - start < timeout) {
     9→    try {
    10→      const response = await fetch(url);
    11→      if (response.ok) {
    12→        return;
    13→      }
    14→    } catch {
    15→      // Server not ready yet
    16→    }
    17→    await new Promise(resolve => setTimeout(resolve, 500));
    18→  }
    19→  throw new Error(`Server at ${url} did not start within ${timeout}ms`);
    20→}
    21→
    22→export default async function globalSetup() {
    23→  const backendPath = resolve(__dirname, '../../../go-backend/server');
    24→  const backendUrl = 'http://localhost:9712/api/v1/ping';
    25→
    26→  // Check if server is already running
    27→  try {
    28→    const response = await fetch(backendUrl);
    29→    if (response.ok) {
    30→      console.log('Backend server already running');
    31→      return;
    32→    }
    33→  } catch {
    34→    // Server not running, we'll start it
    35→  }
    36→
    37→  console.log('Starting backend server...');
    38→
    39→  serverProcess = spawn(backendPath, [], {
    40→    stdio: 'pipe',
    41→    env: {
    42→      ...process.env,
    43→      FAMILIAR_TEST_MODE: 'true',
    44→    },
    45→    detached: true,
    46→  });
    47→
    48→  serverProcess.stdout?.on('data', (data) => {
    49→    console.log(`[backend] ${data}`);
    50→  });
    51→
    52→  serverProcess.stderr?.on('data', (data) => {
    53→    console.error(`[backend] ${data}`);
    54→  });
    55→
    56→  // Store the PID for teardown
    57→  if (serverProcess.pid) {
    58→    process.env.BACKEND_PID = String(serverProcess.pid);
    59→  }
    60→
    61→  // Wait for server to be ready
    62→  await waitForServer(backendUrl);
    63→  console.log('Backend server ready');
    64→}
    65→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
