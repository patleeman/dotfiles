     1→import React, { useState, useEffect, useRef, useCallback } from 'react';
     2→import { useQuery, useQueryClient } from '@tanstack/react-query';
     3→import { useNavigate } from 'react-router-dom';
     4→import { api } from '../../lib/api';
     5→import { clsx } from 'clsx';
     6→import { ask } from '@tauri-apps/plugin-dialog';
     7→import { useSystem } from '../../context/SystemContext';
     8→import { useAgents } from '../../context/AgentContext';
     9→
    10→export const SettingsView: React.FC = () => {
    11→  const navigate = useNavigate();
    12→  const queryClient = useQueryClient();
    13→  const { setExplorerCollapsed } = useAgents();
    14→  const { data: config, refetch: refetchConfig } = useQuery({
    15→    queryKey: ['config'],
    16→    queryFn: () => api.getConfig(),
    17→  });
    18→
    19→  const { data: apiKeys, refetch: refetchKeys } = useQuery({
    20→    queryKey: ['apiKeys'],
    21→    queryFn: () => api.getApiKeys(),
    22→  });
    23→
    24→  const { data: vaultSecrets, refetch: refetchVault } = useQuery({
    25→    queryKey: ['vaultSecrets'],
    26→    queryFn: () => api.listVaultSecrets(),
    27→  });
    28→
    29→  const { data: status } = useQuery({
    30→    queryKey: ['status'],
    31→    queryFn: () => api.getStatus(),
    32→    refetchInterval: 5000,
    33→  });
    34→
    35→  const handleToggleAlwaysAllowAll = async () => {
    36→    const current = !!config?.security?.always_allow_all;
    37→    if (!current) {
    38→      const confirmed = await ask("WARNING: This will automatically approve ALL tool calls (including shell and browser) from ALL agents and sub-agents. This grants autonomous agents full control over your local system and web presence. Are you sure you want to disable all security oversight?", {
    39→        title: "Danger: Disable All Approvals",
    40→        kind: "error",
    41→      });
    42→      if (!confirmed) return;
    43→    }
    44→
    45→    try {
    46→      await api.updateConfig({ security: { always_allow_all: !current } });
    47→      await refetchConfig();
    48→      triggerSuccess();
    49→    } catch (err) {
    50→      console.error('Failed to toggle always allow all:', err);
    51→    }
    52→  };
    53→
    54→  const handleUpdateShellPermissionMode = async (mode: string) => {
    55→    try {
    56→      await api.updateConfig({ security: { shell_permission_mode: mode } });
    57→      await refetchConfig();
    58→      triggerSuccess();
    59→    } catch (err) {
    60→      console.error('Failed to update shell permission mode:', err);
    61→    }
    62→  };
    63→
    64→  const handleToggleSubAgentsGlobal = async () => {
    65→    try {
    66→      const current = !!config?.sub_agent?.enabled;
    67→      await api.updateConfig({ sub_agent: { enabled: !current } });
    68→      await refetchConfig();
    69→      triggerSuccess();
    70→    } catch (err) {
    71→      console.error('Failed to toggle sub-agents globally:', err);
    72→    }
    73→  };
    74→
    75→
    76→
    77→  const handleToggleCLIEnabled = async (cli: 'claude_code' | 'codex') => {
    78→    try {
    79→      const current = !!config?.sub_agent?.[cli]?.enabled;
    80→      await api.updateConfig({ sub_agent: { [cli]: { enabled: !current } } });
    81→      await refetchConfig();
    82→      triggerSuccess();
    83→    } catch (err) {
    84→      console.error(`Failed to toggle ${cli}:`, err);
    85→    }
    86→  };
    87→
    88→  const handleUpdateClaudeTools = async (tools: string) => {
    89→    try {
    90→      const toolList = tools.split(',').map(t => t.trim()).filter(Boolean);
    91→      await api.updateConfig({ sub_agent: { claude_code: { allowed_tools: toolList } } });
    92→      await refetchConfig();
    93→      triggerSuccess();
    94→    } catch (err) {
    95→      console.error('Failed to update Claude tools:', err);
    96→    }
    97→  };
    98→
    99→  const handleUpdateCodexMode = async (mode: string) => {
   100→    try {
   101→      await api.updateConfig({ sub_agent: { codex: { approval_mode: mode } } });
   102→      await refetchConfig();
   103→      triggerSuccess();
   104→    } catch (err) {
   105→      console.error('Failed to update Codex mode:', err);
   106→    }
   107→  };
   108→
   109→  const [theme, setTheme] = useState(config?.ui?.theme || 'default');
   110→  const [isSaving, setIsSaving] = useState(false);
   111→  const [showSuccess, setShowSuccess] = useState(false);
   112→  const [newKey, setNewKey] = useState<{ provider: string; key: string }>({ provider: '', key: '' });
   113→  const [newVaultSecret, setNewVaultSecret] = useState<{ name: string; value: string }>({ name: '', value: '' });
   114→  const [customBaseUrl, setCustomBaseUrl] = useState('');
   115→  const [isAddingCustomProvider, setIsAddingCustomProvider] = useState(false);
   116→  const [newCustomProviderName, setNewCustomProviderName] = useState('');
   117→
   118→  const [editingProvider, setEditingProvider] = useState<string | null>(null);
   119→  const [editingCapability, setEditingCapability] = useState<string>('chat');
   120→  const [newModelName, setNewModelName] = useState('');
   121→  const [isFetchingModels, setIsFetchingModels] = useState(false);
   122→  const { activeSettingsTab: activeTab } = useSystem();
   123→
   124→  const [recordingHotkey, setRecordingHotkey] = useState<string | null>(null);
   125→  const autoFetchedProviders = useRef<Set<string>>(new Set());
   126→
   127→  // Thinking configuration state - track which model is being edited
   128→  const [editingThinkingModel, setEditingThinkingModel] = useState<string | null>(null);
   129→
   130→  // Reasoning levels
   131→  type ReasoningLevel = '' | 'low' | 'medium' | 'high';
   132→  const reasoningLevels: { value: ReasoningLevel; label: string }[] = [
   133→    { value: '', label: 'None' },
   134→    { value: 'low', label: 'Low' },
   135→    { value: 'medium', label: 'Medium' },
   136→    { value: 'high', label: 'High' },
   137→  ];
   138→
   139→  // Helper to parse model string for reasoning level
   140→  // e.g., "claude-haiku-4.5:thinking-high" -> { baseModel: "claude-haiku-4.5", level: "high" }
   141→  const parseModelLevel = (model: string): { baseModel: string; level: ReasoningLevel } => {
   142→    for (const l of ['low', 'medium', 'high'] as ReasoningLevel[]) {
   143→      const suffix = `:thinking-${l}`;
   144→      if (model.endsWith(suffix)) {
   145→        return { baseModel: model.replace(suffix, ''), level: l };
   146→      }
   147→    }
   148→    // Legacy: :thinking without level = high
   149→    if (model.endsWith(':thinking')) {
   150→      return { baseModel: model.replace(':thinking', ''), level: 'high' };
   151→    }
   152→    return { baseModel: model, level: '' };
   153→  };
   154→
   155→  // Helper to build model string from base and level
   156→  const buildModelString = (baseModel: string, level: ReasoningLevel): string => {
   157→    if (level) {
   158→      return `${baseModel}:thinking-${level}`;
   159→    }
   160→    return baseModel;
   161→  };
   162→
   163→  // Providers that support thinking/reasoning
   164→  const thinkingProviders = ['openrouter', 'anthropic', 'openai', 'gemini'];
   165→
   166→  // Update a model's reasoning level
   167→  const handleUpdateModelLevel = async (oldModel: string, newLevel: ReasoningLevel) => {
   168→    if (!editingProvider || !editingCapability) return;
   169→
   170→    const { baseModel } = parseModelLevel(oldModel);
   171→    const newModel = buildModelString(baseModel, newLevel);
   172→
   173→    if (newModel === oldModel) return; // No change
   174→
   175→    const models = availableModels[editingProvider]?.[editingCapability] || [];
   176→    const updatedModels = models.map(m => m === oldModel ? newModel : m);
   177→
   178→    const updatedAvailableModels = {
   179→      ...availableModels,
   180→      [editingProvider]: {
   181→        ...(availableModels[editingProvider] || {}),
   182→        [editingCapability]: updatedModels
   183→      }
   184→    };
   185→
   186→    setIsSaving(true);
   187→    try {
   188→      await api.updateConfig({ available_models: updatedAvailableModels });
   189→      await refetchConfig();
   190→      triggerSuccess();
   191→    } catch (err) {
   192→      console.error('Failed to update model reasoning level:', err);
   193→    } finally {
   194→      setIsSaving(false);
   195→    }
   196→  };
   197→
   198→  useEffect(() => {
   199→    setExplorerCollapsed(false);
   200→  }, []);
   201→
   202→  const successTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);
   203→  const triggerSuccess = useCallback(() => {
   204→    setShowSuccess(true);
   205→    if (successTimeoutRef.current) clearTimeout(successTimeoutRef.current);
   206→    successTimeoutRef.current = setTimeout(() => setShowSuccess(false), 3000);
   207→  }, []);
   208→
   209→  useEffect(() => {
   210→    if (recordingHotkey) {
   211→      const handleGlobalKeyDown = (e: KeyboardEvent) => {
   212→        // Don't intercept if it's just a modifier key
   213→        if (['Control', 'Shift', 'Alt', 'Meta'].includes(e.key)) return;
   214→
   215→        e.preventDefault();
   216→        e.stopPropagation();
   217→
   218→        if (e.key === 'Escape') {
   219→          setRecordingHotkey(null);
   220→          return;
   221→        }
   222→
   223→        const modifiers = [];
   224→        if (e.metaKey) modifiers.push('Cmd');
   225→        else if (e.ctrlKey) modifiers.push('Ctrl');
   226→
   227→        if (e.shiftKey) modifiers.push('Shift');
   228→        if (e.altKey) modifiers.push('Alt');
   229→
   230→        let key = e.key;
   231→        if (key === ' ') key = 'Space';
   232→        if (key.length === 1) key = key.toUpperCase();
   233→
   234→        const hotkey = modifiers.length > 0 ? `${modifiers.join('+')}+${key}` : key;
   235→
   236→        handleUpdateHotkey(recordingHotkey, hotkey);
   237→        setRecordingHotkey(null);
   238→      };
   239→
   240→      window.addEventListener('keydown', handleGlobalKeyDown, true);
   241→      return () => window.removeEventListener('keydown', handleGlobalKeyDown, true);
   242→    }
   243→  }, [recordingHotkey, config]);
   244→
   245→  const handleUpdateHotkey = async (key: string, value: string) => {
   246→    const updatedHotkeys = { ...((config?.ui as any)?.hotkeys || {}), [key]: value };
   247→    try {
   248→      await api.updateConfig({ ui: { hotkeys: updatedHotkeys } });
   249→      await refetchConfig();
   250→      triggerSuccess();
   251→    } catch (err) {
   252→      console.error('Failed to update hotkey:', err);
   253→    }
   254→  };
   255→
   256→  const hotkeyDefaults: Record<string, string> = {
   257→    'global_back': 'Escape',
   258→    'new_agent': 'Cmd+N',
   259→    'focus_input': 'Cmd+L',
   260→    'toggle_sidebar': 'Cmd+B',
   261→    'toggle_settings': 'Cmd+,',
   262→    'toggle_pause': 'Cmd+P',
   263→    'compact': 'Cmd+Shift+C',
   264→    'toggle_unibar': 'Cmd+K',
   265→    'delete_agent': 'Cmd+D',
   266→    'toggle_explorer': 'Cmd+E',
   267→  };
   268→
   269→  const hotkeyLabels: Record<string, string> = {
   270→    'global_back': 'Global Back / Exit Dashboard',
   271→    'new_agent': 'Create New Agent (Dashboard)',
   272→    'focus_input': 'Focus Chat Input (Workspace)',
   273→    'toggle_sidebar': 'Toggle Sidebar (Workspace)',
   274→    'toggle_settings': 'Toggle Settings (Workspace)',
   275→    'toggle_pause': 'Toggle Pause/Resume',
   276→    'compact': 'Compact History (Workspace)',
   277→    'toggle_unibar': 'Omnibar / Command Palette',
   278→    'delete_agent': 'Delete Highlighted Agent (Dashboard)',
   279→    'toggle_explorer': 'Toggle Explorer Panel',
   280→  };
   281→
   282→  // Pointer-based drag state (bypasses Tauri's drag interception)
   283→  const [isDragging, setIsDragging] = useState(false);
   284→  const [dragSourceIndex, setDragSourceIndex] = useState<number | null>(null);
   285→  const [dragTargetIndex, setDragTargetIndex] = useState<number | null>(null);
   286→  const itemRefs = useRef<(HTMLDivElement | null)[]>([]);
   287→  const containerRef = useRef<HTMLDivElement>(null);
   288→  const scrollRef = useRef<HTMLDivElement>(null);
   289→
   290→  useEffect(() => {
   291→    const handleKeyDown = (e: KeyboardEvent) => {
   292→      // Don't scroll if we're recording a hotkey or typing in an input
   293→      if (recordingHotkey) return;
   294→
   295→      const activeElement = document.activeElement;
   296→      const isInput = activeElement instanceof HTMLInputElement ||
   297→        activeElement instanceof HTMLTextAreaElement ||
   298→        (activeElement as HTMLElement)?.isContentEditable;
   299→
   300→      if (isInput && !(e.metaKey || e.ctrlKey)) return;
   301→
   302→      if (e.key === 'ArrowUp') {
   303→        if (scrollRef.current) {
   304→          e.preventDefault();
   305→          scrollRef.current.scrollBy({ top: -100, behavior: 'smooth' });
   306→        }
   307→      }
   308→      if (e.key === 'ArrowDown') {
   309→        if (scrollRef.current) {
   310→          e.preventDefault();
   311→          scrollRef.current.scrollBy({ top: 100, behavior: 'smooth' });
   312→        }
   313→      }
   314→      if (e.key === ' ' && !isInput) {
   315→        if (scrollRef.current) {
   316→          e.preventDefault();
   317→          const direction = e.shiftKey ? -1 : 1;
   318→          scrollRef.current.scrollBy({
   319→            top: direction * scrollRef.current.clientHeight * 0.8,
   320→            behavior: 'smooth'
   321→          });
   322→        }
   323→      }
   324→    };
   325→
   326→    window.addEventListener('keydown', handleKeyDown);
   327→    return () => window.removeEventListener('keydown', handleKeyDown);
   328→  }, [recordingHotkey]);
   329→
   330→
   331→
   332→  useEffect(() => {
   333→    if (!editingProvider && config?.available_models && apiKeys) {
   334→      const availableModels = config.available_models;
   335→      const providers = Object.keys(availableModels);
   336→
   337→      // Preference order for default selection
   338→      const preference = ['openrouter', 'anthropic', 'openai', 'gemini'];
   339→      const defaultProvider = preference.find(p => providers.some(ap => ap.toLowerCase() === p));
   340→
   341→      if (defaultProvider) {
   342→        const matching = providers.find(p => p.toLowerCase() === defaultProvider);
   343→        if (matching) {
   344→          setEditingProvider(matching);
   345→          setNewKey(prev => ({ ...prev, provider: matching }));
   346→        }
   347→      } else if (providers.length > 0) {
   348→        setEditingProvider(providers[0]);
   349→        setNewKey(prev => ({ ...prev, provider: providers[0] }));
   350→      }
   351→    }
   352→  }, [config, editingProvider, apiKeys]);
   353→
   354→  useEffect(() => {
   355→    if (editingProvider && config?.custom_providers?.[editingProvider]) {
   356→      setCustomBaseUrl(config?.custom_providers[editingProvider].base_url || '');
   357→    } else {
   358→      setCustomBaseUrl('');
   359→    }
   360→  }, [editingProvider, config?.custom_providers]);
   361→
   362→  const availableModels = config?.available_models || {};
   363→  const localProvidersList = ['ollama', 'lmstudio'];
   364→  const standardProviders = ['openrouter', 'anthropic', 'openai', 'gemini', 'ollama', 'lmstudio'];
   365→
   366→  const handleFetchModels = useCallback(async (provider: string) => {
   367→    if (isFetchingModels) return;
   368→    setIsFetchingModels(true);
   369→    try {
   370→      const response = await api.fetchModels(provider);
   371→      if (response && response.models) {
   372→        const updatedAvailableModels = {
   373→          ...availableModels,
   374→          [provider]: {
   375→            ...(availableModels[provider] || {}),
   376→            chat: response.models
   377→          }
   378→        };
   379→
   380→        // If this is the active provider and has no model set, pick the first one
   381→        const updates: any = { available_models: updatedAvailableModels };
   382→        if (provider === config?.inference?.chat?.provider && (!config?.inference?.chat?.model || (availableModels[provider]?.chat?.length || 0) === 0)) {
   383→          if (response.models.length > 0) {
   384→            updates.inference = {
   385→              ...config.inference,
   386→              chat: {
   387→                ...config.inference.chat,
   388→                model: response.models[0]
   389→              }
   390→            };
   391→          }
   392→        }
   393→
   394→        await api.updateConfig(updates);
   395→        await refetchConfig();
   396→        triggerSuccess();
   397→      }
   398→    } catch (err) {
   399→      console.error('Failed to fetch models:', err);
   400→    } finally {
   401→      setIsFetchingModels(false);
   402→    }
   403→  }, [availableModels, config, isFetchingModels, refetchConfig, triggerSuccess]);
   404→
   405→  useEffect(() => {
   406→    if (editingProvider && localProvidersList.includes(editingProvider.toLowerCase())) {
   407→      const currentChatModels = availableModels[editingProvider]?.chat || [];
   408→      if (currentChatModels.length === 0 && !isFetchingModels && !autoFetchedProviders.current.has(editingProvider.toLowerCase())) {
   409→        autoFetchedProviders.current.add(editingProvider.toLowerCase());
   410→        handleFetchModels(editingProvider);
   411→      }
   412→    }
   413→  }, [editingProvider, availableModels, isFetchingModels, handleFetchModels]);
   414→
   415→  const allProviders = Object.keys(availableModels);
   416→  const cloudProviders = allProviders.filter(p => standardProviders.includes(p.toLowerCase()) && !localProvidersList.includes(p.toLowerCase()));
   417→  const localProviders = allProviders.filter(p => standardProviders.includes(p.toLowerCase()) && localProvidersList.includes(p.toLowerCase()));
   418→  const userCustomProvidersList = allProviders.filter(p => !standardProviders.includes(p.toLowerCase()));
   419→
   420→  const currentModels = (editingProvider && editingCapability) ? (availableModels[editingProvider]?.[editingCapability] || []) : [];
   421→  const hasCustomBaseUrl = !!customBaseUrl.trim();
   422→
   423→  const handleAddCustomProvider = async () => {
   424→    if (!newCustomProviderName.trim()) return;
   425→    const name = newCustomProviderName.trim().toLowerCase();
   426→    if (standardProviders.includes(name) || userCustomProvidersList.includes(name)) {
   427→      alert('Provider name already exists or is reserved.');
   428→      return;
   429→    }
   430→
   431→    setIsSaving(true);
   432→    try {
   433→      const updatedCustomProviders = {
   434→        ...(config?.custom_providers || {}),
   435→        [name]: { base_url: '' }
   436→      };
   437→      await api.updateConfig({ custom_providers: updatedCustomProviders });
   438→      await refetchConfig();
   439→      setEditingProvider(name);
   440→      setIsAddingCustomProvider(false);
   441→      setNewCustomProviderName('');
   442→      triggerSuccess();
   443→    } catch (err) {
   444→      console.error('Failed to add custom provider:', err);
   445→    } finally {
   446→      setIsSaving(false);
   447→    }
   448→  };
   449→
   450→  const handleRemoveCustomProvider = async (name: string) => {
   451→    const confirmed = await ask(`Are you sure you want to delete the custom provider "${name}"?`, {
   452→      title: 'Delete Provider',
   453→      kind: 'warning',
   454→    });
   455→
   456→    if (!confirmed) return;
   457→
   458→    setIsSaving(true);
   459→    try {
   460→      // Wipe API key from keychain first
   461→      try {
   462→        await api.removeApiKey(name);
   463→      } catch (keyErr) {
   464→        console.warn(`Failed to remove API key for ${name}:`, keyErr);
   465→      }
   466→
   467→      const updatedCustomProviders = { ...(config?.custom_providers || {}) };
   468→      delete updatedCustomProviders[name];
   469→
   470→      const updatedAvailableModels = { ...(config?.available_models || {}) };
   471→      delete updatedAvailableModels[name];
   472→
   473→      await api.updateConfig({
   474→        custom_providers: updatedCustomProviders,
   475→        available_models: updatedAvailableModels
   476→      });
   477→      await queryClient.invalidateQueries({ queryKey: ['config'] });
   478→      await queryClient.invalidateQueries({ queryKey: ['apiKeys'] });
   479→      if (editingProvider === name) {
   480→        setEditingProvider(cloudProviders[0] || 'openai');
   481→      }
   482→      triggerSuccess();
   483→    } catch (err) {
   484→      console.error('Failed to remove custom provider:', err);
   485→    } finally {
   486→      setIsSaving(false);
   487→    }
   488→  };
   489→
   490→  const handleAddModel = async () => {
   491→    if (!editingProvider || !editingCapability || !newModelName.trim()) return;
   492→
   493→    const modelToAdd = newModelName.trim();
   494→    if (currentModels.includes(modelToAdd)) return;
   495→
   496→    const updatedModels = [...currentModels, modelToAdd];
   497→    const updatedAvailableModels = {
   498→      ...availableModels,
   499→      [editingProvider]: {
   500→        ...(availableModels[editingProvider] || {}),
   501→        [editingCapability]: updatedModels
   502→      }
   503→    };
   504→
   505→    const updates: any = { available_models: updatedAvailableModels };
   506→
   507→    // If this is the first model for this provider, and it's the default provider, set it as default model
   508→    if (editingProvider === config?.inference?.chat?.provider && editingCapability === 'chat' && currentModels.length === 0) {
   509→      updates.inference = {
   510→        ...config.inference,
   511→        chat: {
   512→          ...config.inference.chat,
   513→          model: modelToAdd
   514→        }
   515→      };
   516→    }
   517→
   518→    setIsSaving(true);
   519→    try {
   520→      await api.updateConfig(updates);
   521→      setNewModelName('');
   522→      await refetchConfig();
   523→      triggerSuccess();
   524→    } catch (err) {
   525→      console.error('Failed to add model:', err);
   526→    } finally {
   527→      setIsSaving(false);
   528→    }
   529→  };
   530→
   531→  const handleRemoveModel = async (modelName: string) => {
   532→    if (!editingProvider || !editingCapability) return;
   533→    const updatedModels = currentModels.filter(m => m !== modelName);
   534→    const updatedAvailableModels = {
   535→      ...availableModels,
   536→      [editingProvider]: {
   537→        ...(availableModels[editingProvider] || {}),
   538→        [editingCapability]: updatedModels
   539→      }
   540→    };
   541→
   542→    const updates: any = { available_models: updatedAvailableModels };
   543→
   544→    // If we removed the top model, or changed the list, and this is the default provider, update the default model
   545→    if (editingProvider === config?.inference?.chat?.provider && editingCapability === 'chat' && updatedModels.length > 0) {
   546→      if (updatedModels[0] !== currentModels[0]) {
   547→        updates.inference = {
   548→          ...config.inference,
   549→          chat: {
   550→            ...config.inference.chat,
   551→            model: updatedModels[0]
   552→          }
   553→        };
   554→      }
   555→    }
   556→
   557→    setIsSaving(true);
   558→    try {
   559→      await api.updateConfig(updates);
   560→      await refetchConfig();
   561→      triggerSuccess();
   562→    } catch (err) {
   563→      console.error('Failed to remove model:', err);
   564→    } finally {
   565→      setIsSaving(false);
   566→    }
   567→  };
   568→
   569→  const saveModelOrder = async (newModels: string[]) => {
   570→    if (!editingProvider || !editingCapability) return;
   571→
   572→    const updatedAvailableModels = {
   573→      ...availableModels,
   574→      [editingProvider]: {
   575→        ...(availableModels[editingProvider] || {}),
   576→        [editingCapability]: newModels
   577→      }
   578→    };
   579→
   580→    const updates: any = { available_models: updatedAvailableModels };
   581→
   582→    // If we moved something to the top, and this is the default provider, update the default model
   583→    if (editingProvider === config?.inference?.chat?.provider && editingCapability === 'chat') {
   584→      updates.inference = {
   585→        ...config.inference,
   586→        chat: {
   587→          ...config.inference.chat,
   588→          model: newModels[0]
   589→        }
   590→      };
   591→    }
   592→
   593→    setIsSaving(true);
   594→    try {
   595→      await api.updateConfig(updates);
   596→      await refetchConfig();
   597→      triggerSuccess();
   598→    } catch (err) {
   599→      console.error('Failed to update model order:', err);
   600→    } finally {
   601→      setIsSaving(false);
   602→    }
   603→  };
   604→
   605→  const handleMoveModel = async (modelName: string, direction: 'up' | 'down') => {
   606→    if (!editingProvider || !editingCapability) return;
   607→
   608→    const index = currentModels.indexOf(modelName);
   609→    if (index === -1) return;
   610→    if (direction === 'up' && index === 0) return;
   611→    if (direction === 'down' && index === currentModels.length - 1) return;
   612→
   613→    const newModels = [...currentModels];
   614→    const targetIndex = direction === 'up' ? index - 1 : index + 1;
   615→    [newModels[index], newModels[targetIndex]] = [newModels[targetIndex], newModels[index]];
   616→
   617→    await saveModelOrder(newModels);
   618→  };
   619→
   620→  // Pointer-based drag handlers (works in Tauri)
   621→  const handlePointerDown = useCallback((e: React.PointerEvent, index: number) => {
   622→    e.preventDefault();
   623→    setIsDragging(true);
   624→    setDragSourceIndex(index);
   625→    setDragTargetIndex(index);
   626→    (e.target as HTMLElement).setPointerCapture(e.pointerId);
   627→  }, []);
   628→
   629→  const handlePointerMove = useCallback((e: React.PointerEvent) => {
   630→    if (!isDragging || dragSourceIndex === null || !containerRef.current) return;
   631→
   632→    const containerRect = containerRef.current.getBoundingClientRect();
   633→    const y = e.clientY - containerRect.top;
   634→
   635→    // Find which item we're over
   636→    let newTargetIndex = dragSourceIndex;
   637→    for (let i = 0; i < itemRefs.current.length; i++) {
   638→      const item = itemRefs.current[i];
   639→      if (!item) continue;
   640→      const rect = item.getBoundingClientRect();
   641→      const itemY = rect.top - containerRect.top + rect.height / 2;
   642→      if (y < itemY) {
   643→        newTargetIndex = i;
   644→        break;
   645→      }
   646→      newTargetIndex = i + 1;
   647→    }
   648→    newTargetIndex = Math.max(0, Math.min(newTargetIndex, currentModels.length - 1));
   649→
   650→    if (newTargetIndex !== dragTargetIndex) {
   651→      setDragTargetIndex(newTargetIndex);
   652→    }
   653→  }, [isDragging, dragSourceIndex, dragTargetIndex, currentModels.length]);
   654→
   655→  const handlePointerUp = useCallback(async (e: React.PointerEvent) => {
   656→    if (!isDragging) return;
   657→    (e.target as HTMLElement).releasePointerCapture(e.pointerId);
   658→
   659→    const sourceIndex = dragSourceIndex;
   660→    const targetIndex = dragTargetIndex;
   661→
   662→    setIsDragging(false);
   663→    setDragSourceIndex(null);
   664→    setDragTargetIndex(null);
   665→
   666→    if (sourceIndex === null || targetIndex === null || sourceIndex === targetIndex) return;
   667→
   668→    const newModels = [...currentModels];
   669→    const [removed] = newModels.splice(sourceIndex, 1);
   670→    newModels.splice(targetIndex, 0, removed);
   671→
   672→    await saveModelOrder(newModels);
   673→  }, [isDragging, dragSourceIndex, dragTargetIndex, currentModels, saveModelOrder]);
   674→
   675→  const handleUpdateTheme = async (newTheme: string) => {
   676→    setTheme(newTheme);
   677→    try {
   678→      await api.updateConfig({ ui: { theme: newTheme } });
   679→      localStorage.setItem('pa_theme', newTheme);
   680→      if (newTheme === 'default') {
   681→        document.documentElement.removeAttribute('data-theme');
   682→      } else {
   683→        document.documentElement.setAttribute('data-theme', newTheme);
   684→      }
   685→      await refetchConfig();
   686→      triggerSuccess();
   687→    } catch (err) {
   688→      console.error('Failed to update theme:', err);
   689→    }
   690→  };
   691→
   692→  const handleToggleAutoCompaction = async () => {
   693→    try {
   694→      const current = config?.agent?.auto_compaction_enabled !== false; // Default to true if undefined
   695→      await api.updateConfig({ agent: { auto_compaction_enabled: !current } });
   696→      await refetchConfig();
   697→      triggerSuccess();
   698→    } catch (err) {
   699→      console.error('Failed to toggle auto-compaction:', err);
   700→    }
   701→  };
   702→
   703→  const handleSetApiKey = async () => {
   704→    if (!newKey.provider || !newKey.key) return;
   705→    setIsSaving(true);
   706→    try {
   707→      await api.setApiKey(newKey.provider, newKey.key);
   708→      setNewKey({ provider: '', key: '' });
   709→      await queryClient.invalidateQueries({ queryKey: ['apiKeys'] });
   710→      triggerSuccess();
   711→    } catch (err) {
   712→      console.error('Failed to set API key:', err);
   713→    } finally {
   714→      setIsSaving(false);
   715→    }
   716→  };
   717→
   718→  const handleSaveCustomBaseUrl = async () => {
   719→    if (!customBaseUrl.trim() || !editingProvider) return;
   720→    setIsSaving(true);
   721→    try {
   722→      const updatedCustomProviders = {
   723→        ...(config?.custom_providers || {}),
   724→        [editingProvider]: { base_url: customBaseUrl.trim() }
   725→      };
   726→      await api.updateConfig({ custom_providers: updatedCustomProviders });
   727→      await queryClient.invalidateQueries({ queryKey: ['config'] });
   728→      triggerSuccess();
   729→    } catch (err) {
   730→      console.error('Failed to update custom provider base URL:', err);
   731→    } finally {
   732→      setIsSaving(false);
   733→    }
   734→  };
   735→
   736→  const handleRemoveApiKey = async (provider: string) => {
   737→    const confirmed = await ask(`Are you sure you want to wipe the API key for ${provider.toUpperCase()}? This will prevent agents from using this provider until a new key is registered.`, {
   738→      title: 'Wipe API Key',
   739→      kind: 'warning',
   740→    });
   741→
   742→    if (!confirmed) return;
   743→
   744→    try {
   745→      await api.removeApiKey(provider);
   746→      await queryClient.invalidateQueries({ queryKey: ['apiKeys'] });
   747→    } catch (err) {
   748→      console.error('Failed to remove API key:', err);
   749→    }
   750→  };
   751→
   752→  const handleToggleProvider = async (provider: string, currentEnabled: boolean) => {
   753→    setIsSaving(true);
   754→    try {
   755→      const updatedProviders = {
   756→        ...(config?.providers || {}),
   757→        [provider]: { enabled: !currentEnabled }
   758→      };
   759→      await api.updateConfig({ providers: updatedProviders });
   760→      await queryClient.invalidateQueries({ queryKey: ['config'] });
   761→      await queryClient.invalidateQueries({ queryKey: ['apiKeys'] });
   762→      triggerSuccess();
   763→    } catch (err) {
   764→      console.error('Failed to toggle provider:', err);
   765→    } finally {
   766→      setIsSaving(false);
   767→    }
   768→  };
   769→
   770→  const handleSetVaultSecret = async () => {
   771→    if (!newVaultSecret.name || !newVaultSecret.value) return;
   772→    setIsSaving(true);
   773→    try {
   774→      await api.setVaultSecret(newVaultSecret.name, newVaultSecret.value);
   775→      setNewVaultSecret({ name: '', value: '' });
   776→      await refetchVault();
   777→      triggerSuccess();
   778→    } catch (err) {
   779→      console.error('Failed to set vault secret:', err);
   780→    } finally {
   781→      setIsSaving(false);
   782→    }
   783→  };
   784→
   785→  const handleRemoveVaultSecret = async (name: string) => {
   786→    const confirmed = await ask(`Are you sure you want to delete the secret "${name}"? This cannot be undone.`, {
   787→      title: 'Delete Secret',
   788→      kind: 'warning',
   789→    });
   790→
   791→    if (!confirmed) return;
   792→
   793→    try {
   794→      await api.removeVaultSecret(name);
   795→      refetchVault();
   796→    } catch (err) {
   797→      console.error('Failed to remove vault secret:', err);
   798→    }
   799→  };
   800→
   801→  const themes = [
   802→    { id: 'default', name: 'Matrix Dark', colors: 'bg-[#181c21]', accent: 'bg-[#22d3ee]' },
   803→    { id: 'light', name: 'Paper White', colors: 'bg-[#f2f2f2]', accent: 'bg-[#2563eb]' },
   804→    { id: 'cobalt2', name: 'Cobalt2', colors: 'bg-[#193549]', accent: 'bg-[#ffc600]' },
   805→    { id: 'nerv', name: 'NERV HQ', colors: 'bg-[#1c1c1c]', accent: 'bg-[#ff9500]' },
   806→  ];
   807→
   808→  return (
   809→    <div className="flex h-full bg-background font-mono text-[13px] overflow-hidden">
   810→      {/* Main Content Area */}
   811→      <div className="flex-1 flex flex-col min-w-0 bg-background relative">
   812→        <div className="flex-1 overflow-auto p-8 custom-scrollbar relative" ref={scrollRef}>
   813→          <div className="max-w-4xl mx-auto pb-20">
   814→            {activeTab === 'models' && (
   815→              <div className="space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-300 font-mono">
   816→                {/* Model Registry Section */}
   817→                <section className="space-y-3">
   818→                  <div className="flex flex-col gap-0.5">
   819→                    <div className="flex items-center gap-2 text-accent/80">
   820→                      <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/PROVIDER_CONFIG</h2>
   821→                    </div>
   822→                    <p className="text-[10px] text-text-tertiary/60 italic leading-normal uppercase font-black tracking-tight">
   823→                      LLM NODES AND ENDPOINTS. CREDENTIALS STORED IN SYSTEM KEYCHAIN.
   824→                    </p>
   825→                  </div>
   826→
   827→                  <div className="flex flex-col md:flex-row bg-surface/5 border border-border/10 overflow-hidden min-h-[450px]">
   828→                    {/* Left Sidebar: Providers */}
   829→                    <div className="w-full md:w-48 border-b md:border-b-0 md:border-r border-border/10 bg-background/20 flex flex-col font-mono">
   830→                      <div className="p-3 border-b border-border/10 bg-background/10">
   831→                        <span className="text-[10px] font-black text-accent/60 uppercase tracking-[0.2em]">/INDEX</span>
   832→                      </div>
   833→                      <div className="flex-1 overflow-auto p-1.5 space-y-0.5 custom-scrollbar">
   834→                        <div className="px-2 pb-1">
   835→                          <span className="text-[8px] font-black text-text-tertiary/30 uppercase tracking-widest">/CLOUD</span>
   836→                        </div>
   837→                        {cloudProviders.map(p => {
   838→                          const providerData = apiKeys?.find(k => k.provider.toLowerCase() === p.toLowerCase());
   839→                          const isConfigured = providerData?.configured;
   840→                          const isEnabled = providerData?.enabled === true;
   841→                          return (
   842→                            <button
   843→                              key={p}
   844→                              onClick={() => {
   845→                                setEditingProvider(p);
   846→                                setNewKey(prev => ({ ...prev, provider: p }));
   847→                              }}
   848→                              className={clsx(
   849→                                "w-full px-2 py-1 text-left text-[11px] font-black uppercase transition-all flex items-center justify-between",
   850→                                editingProvider === p
   851→                                  ? "text-accent"
   852→                                  : "text-text-tertiary/60 hover:text-text-secondary hover:translate-x-0.5",
   853→                                !isEnabled && "opacity-40"
   854→                              )}
   855→                            >
   856→                              <div className="flex items-center gap-2">
   857→                                <span className="w-2">{editingProvider === p ? '>' : ' '}</span>
   858→                                <span className="truncate">/{p}</span>
   859→                              </div>
   860→                              <div className={clsx(
   861→                                "w-1 h-1 rounded-full",
   862→                                isConfigured ? "bg-status-success animate-pulse" : "bg-status-error/40"
   863→                              )} />
   864→                            </button>
   865→                          );
   866→                        })}
   867→
   868→                        <div className="pt-4 mt-2">
   869→                          <div className="px-2 pb-1 flex items-center justify-between">
   870→                            <span className="text-[8px] font-black text-text-tertiary/30 uppercase tracking-widest">/CUSTOM</span>
   871→                            <button
   872→                              onClick={() => setIsAddingCustomProvider(true)}
   873→                              className="text-accent/60 hover:text-accent transition-colors text-[10px]"
   874→                            >
   875→                              [+]
   876→                            </button>
   877→                          </div>
   878→
   879→                          {isAddingCustomProvider && (
   880→                            <div className="px-1.5 py-1 space-y-1">
   881→                              <input
   882→                                autoFocus
   883→                                type="text"
   884→                                placeholder="NAME..."
   885→                                value={newCustomProviderName}
   886→                                onChange={(e) => setNewCustomProviderName(e.target.value.toLowerCase().replace(/[^a-z0-9_-]/g, ''))}
   887→                                onKeyDown={(e) => {
   888→                                  if (e.key === 'Enter') handleAddCustomProvider();
   889→                                  if (e.key === 'Escape') setIsAddingCustomProvider(false);
   890→                                }}
   891→                                className="w-full bg-transparent border-b border-accent/20 px-1 py-0.5 text-[10px] text-text-primary focus:outline-none font-mono uppercase"
   892→                              />
   893→                              <div className="flex gap-1">
   894→                                  <button
   895→                                    onClick={handleAddCustomProvider}
   896→                                    className="flex-1 py-0.5 text-accent text-[9px] font-black border border-accent/20 hover:bg-accent/5"
   897→                                  >
   898→                                    [ADD]
   899→                                  </button>
   900→                                  <button
   901→                                    onClick={() => setIsAddingCustomProvider(false)}
   902→                                    className="flex-1 py-0.5 text-text-tertiary/60 text-[9px] font-black border border-border/10 hover:bg-surface/10"
   903→                                  >
   904→                                    [CANCEL]
   905→                                  </button>
   906→                              </div>
   907→                            </div>
   908→                          )}
   909→
   910→                          {userCustomProvidersList.map(p => {
   911→                            const providerData = apiKeys?.find(k => k.provider.toLowerCase() === p.toLowerCase());
   912→                            const isConfigured = providerData?.configured;
   913→                            const isEnabled = providerData?.enabled === true;
   914→                            return (
   915→                              <button
   916→                                key={p}
   917→                                onClick={() => {
   918→                                  setEditingProvider(p);
   919→                                  setNewKey(prev => ({ ...prev, provider: p }));
   920→                                }}
   921→                                className={clsx(
   922→                                  "w-full px-2 py-1 text-left text-[11px] font-black uppercase transition-all flex items-center justify-between",
   923→                                  editingProvider === p
   924→                                    ? "text-accent"
   925→                                    : "text-text-tertiary/60 hover:text-text-secondary hover:translate-x-0.5",
   926→                                  !isEnabled && "opacity-40"
   927→                                )}
   928→                              >
   929→                                <div className="flex items-center gap-2">
   930→                                  <span className="w-2">{editingProvider === p ? '>' : ' '}</span>
   931→                                  <span className="truncate">/{p}</span>
   932→                                </div>
   933→                                <div className={clsx(
   934→                                  "w-1 h-1 rounded-full",
   935→                                  isConfigured ? "bg-status-success animate-pulse" : "bg-status-error/40"
   936→                                )} />
   937→                              </button>
   938→                            );
   939→                          })}
   940→                        </div>
   941→
   942→                        <div className="pt-4 mt-2">
   943→                          <div className="px-2 pb-1">
   944→                            <span className="text-[8px] font-black text-text-tertiary/30 uppercase tracking-widest">/LOCAL</span>
   945→                          </div>
   946→
   947→                          <div className="space-y-0.5">
   948→                            {localProviders.map(p => {
   949→                              const isEnabled = apiKeys?.find(k => k.provider.toLowerCase() === p.toLowerCase())?.enabled === true;
   950→                              return (
   951→                                <button
   952→                                  key={p}
   953→                                  onClick={() => {
   954→                                    setNewKey(prev => ({ ...prev, provider: p }));
   955→                                    setEditingProvider(p);
   956→                                  }}
   957→                                  className={clsx(
   958→                                    "w-full px-2 py-1 text-left text-[11px] font-black uppercase transition-all flex items-center justify-between",
   959→                                    editingProvider === p
   960→                                      ? "text-accent"
   961→                                      : "text-text-tertiary/60 hover:text-text-secondary hover:translate-x-0.5",
   962→                                    !isEnabled && "opacity-40"
   963→                                  )}
   964→                                >
   965→                                  <div className="flex items-center gap-2">
   966→                                    <span className="w-2">{editingProvider === p ? '>' : ' '}</span>
   967→                                    <span className="truncate">/{p}</span>
   968→                                  </div>
   969→                                  <div className="w-1 h-1 rounded-full bg-status-success animate-pulse" />
   970→                                </button>
   971→                              );
   972→                            })}
   973→                          </div>
   974→                        </div>
   975→                      </div>
   976→                    </div>
   977→
   978→                    {/* Right Panel: Skills and Models */}
   979→                    <div className="flex-1 flex flex-col bg-background/5 font-mono">
   980→                      {!editingProvider ? (
   981→                        <div className="flex-1 flex flex-col items-center justify-center text-text-tertiary/20 space-y-2">
   982→                          <span className="text-[10px] uppercase font-black tracking-[0.3em]">[AWAITING_SELECTION]</span>
   983→                          <div className="animate-pulse">_</div>
   984→                        </div>
   985→                      ) : (
   986→                        <div className="flex-1 overflow-auto p-5 space-y-8 custom-scrollbar">
   987→                          {/* Provider Header & API Key Management */}
   988→                          <div className="space-y-4">
   989→                            <div className="flex items-center justify-between border-b border-border/10 pb-3">
   990→                              <div className="flex items-center gap-3">
   991→                                <span className="text-[13px] font-black text-text-primary uppercase tracking-[0.1em]">
   992→                                  /{editingProvider}
   993→                                </span>
   994→                              </div>
   995→
   996→                              <div className="flex items-center gap-2">
   997→                                {(() => {
   998→                                  const providerData = apiKeys?.find(k => k.provider.toLowerCase() === editingProvider.toLowerCase());
   999→                                  const isEnabled = providerData?.enabled === true;
  1000→
  1001→                                  return (
  1002→                                    <button
  1003→                                      onClick={() => handleToggleProvider(editingProvider, isEnabled)}
  1004→                                      className={clsx(
  1005→                                        "text-[9px] font-black px-2 py-0.5 transition-all tracking-widest uppercase border active:scale-95",
  1006→                                        isEnabled
  1007→                                          ? "text-status-success border-status-success/20 hover:bg-status-success/5"
  1008→                                          : "text-status-error border-status-error/20 hover:bg-status-error/5"
  1009→                                      )}
  1010→                                    >
  1011→                                      {isEnabled ? '[ON]' : '[OFF]'}
  1012→                                    </button>
  1013→                                  );
  1014→                                })()}
  1015→
  1016→                                {userCustomProvidersList.includes(editingProvider) && (
  1017→                                  <button
  1018→                                    onClick={() => handleRemoveCustomProvider(editingProvider)}
  1019→                                    className="text-[9px] text-text-tertiary/40 hover:text-status-error transition-all uppercase font-black px-2 py-0.5 border border-border/10 hover:bg-status-error/5 active:scale-95"
  1020→                                  >
  1021→                                    [DELETE]
  1022→                                  </button>
  1023→                                )}
  1024→
  1025→                                {apiKeys?.find(k => k.provider.toLowerCase() === editingProvider.toLowerCase())?.configured && !localProvidersList.includes(editingProvider.toLowerCase()) && (
  1026→                                  <button
  1027→                                    onClick={() => handleRemoveApiKey(editingProvider)}
  1028→                                    className="text-[9px] text-text-tertiary/40 hover:text-status-error transition-all uppercase font-black px-2 py-0.5 border border-border/10 hover:bg-status-error/5 active:scale-95"
  1029→                                  >
  1030→                                    [WIPE_KEY]
  1031→                                  </button>
  1032→                                )}
  1033→                              </div>
  1034→                            </div>
  1035→
  1036→                            {/* API Key Input */}
  1037→                            {!localProvidersList.includes(editingProvider.toLowerCase()) ? (
  1038→                              <div className="space-y-2">
  1039→                                <div className="flex flex-col gap-0.5">
  1040→                                  <div className="flex items-center gap-2">
  1041→                                    <span className="text-[9px] font-black text-text-tertiary/60 uppercase tracking-widest">/AUTH_TOKEN</span>
  1042→                                  </div>
  1043→                                </div>
  1044→                                <div className="flex flex-col sm:flex-row gap-2">
  1045→                                  <div className="flex-1 relative">
  1046→                                    <input
  1047→                                      type="password"
  1048→                                      placeholder="PASTE_KEY..."
  1049→                                      value={newKey.key}
  1050→                                      onChange={(e) => setNewKey(prev => ({ ...prev, key: e.target.value }))}
  1051→                                      onKeyDown={(e) => e.key === 'Enter' && handleSetApiKey()}
  1052→                                      className="w-full bg-transparent border-b border-border/10 px-0 py-1 text-[11px] text-text-primary focus:outline-none focus:border-accent/40 font-mono transition-all uppercase"
  1053→                                    />
  1054→                                  </div>
  1055→                                  <button
  1056→                                    onClick={handleSetApiKey}
  1057→                                    disabled={isSaving || !newKey.key}
  1058→                                    className="px-3 py-1 text-accent hover:text-accent-hover font-black text-[10px] uppercase tracking-widest transition-all disabled:opacity-20"
  1059→                                  >
  1060→                                    [REGISTER]
  1061→                                  </button>
  1062→                                </div>
  1063→                              </div>
  1064→                            ) : (
  1065→                              <div className="text-[9px] text-accent/40 font-black uppercase tracking-widest">
  1066→                                /LOCAL_ACTIVE: NO_AUTH_REQUIRED
  1067→                              </div>
  1068→                            )}
  1069→                          </div>
  1070→
  1071→                          {userCustomProvidersList.includes(editingProvider) && (
  1072→                            <div className="space-y-2">
  1073→                              <div className="flex flex-col gap-0.5">
  1074→                                <span className="text-[9px] font-black text-text-tertiary/60 uppercase tracking-widest">/ENDPOINT_URL</span>
  1075→                              </div>
  1076→                              <div className="flex flex-col sm:flex-row gap-2">
  1077→                                <div className="flex-1 relative">
  1078→                                  <input
  1079→                                    type="text"
  1080→                                    placeholder="https://api.provider.com/v1"
  1081→                                    value={customBaseUrl}
  1082→                                    onChange={(e) => setCustomBaseUrl(e.target.value)}
  1083→                                    onKeyDown={(e) => e.key === 'Enter' && handleSaveCustomBaseUrl()}
  1084→                                    className="w-full bg-transparent border-b border-border/10 px-0 py-1 text-[11px] text-text-primary focus:outline-none focus:border-accent/40 font-mono transition-all"
  1085→                                  />
  1086→                                </div>
  1087→                                <button
  1088→                                  onClick={handleSaveCustomBaseUrl}
  1089→                                  disabled={isSaving || !customBaseUrl.trim()}
  1090→                                  className="px-3 py-1 text-accent hover:text-accent-hover font-black text-[10px] uppercase tracking-widest transition-all disabled:opacity-20"
  1091→                                >
  1092→                                  [SAVE]
  1093→                                </button>
  1094→                              </div>
  1095→                            </div>
  1096→                          )}
  1097→
  1098→                          {/* Model Registry Content */}
  1099→                          <div className="space-y-6">
  1100→                            <div className="flex items-center justify-between">
  1101→                              <span className="text-[9px] font-black text-text-tertiary/60 uppercase tracking-widest">/MODELS</span>
  1102→                              {localProvidersList.includes(editingProvider?.toLowerCase() || '') && (
  1103→                                <button
  1104→                                  onClick={() => editingProvider && handleFetchModels(editingProvider)}
  1105→                                  disabled={isFetchingModels}
  1106→                                  className={clsx(
  1107→                                    "text-[9px] font-black uppercase tracking-widest transition-all",
  1108→                                    isFetchingModels ? "text-text-tertiary/20 animate-pulse" : "text-accent hover:text-accent-hover"
  1109→                                  )}
  1110→                                >
  1111→                                  [{isFetchingModels ? 'DISCOVERING...' : 'DISCOVER_LOCAL_MODELS'}]
  1112→                                </button>
  1113→                              )}
  1114→                            </div>
  1115→
  1116→                            {['chat'].map(cap => {
  1117→                              const models = availableModels[editingProvider]?.[cap] || [];
  1118→                              const isEditing = editingCapability === cap;
  1119→
  1120→                              const isOpenRouter = editingProvider?.toLowerCase() === 'openrouter';
  1121→                              const supportsThinking = thinkingProviders.includes(editingProvider?.toLowerCase() || '');
  1122→
  1123→                              return (
  1124→                                <div key={cap} className="space-y-1">
  1125→                                  {/* Column headers */}
  1126→                                  {(supportsThinking || isOpenRouter) && models.length > 0 && (
  1127→                                    <div className="flex items-center gap-2 px-2 py-1 border-b border-border/10">
  1128→                                      <div className="w-6" /> {/* Spacer for drag handle */}
  1129→                                      <span className="flex-1 text-[8px] font-black text-text-tertiary/40 uppercase tracking-widest">MODEL NAME</span>
  1130→                                      {isOpenRouter && (
  1131→                                        <span className="text-[8px] font-black text-text-tertiary/40 uppercase tracking-widest w-24 text-right">PRICING (INPUT/OUTPUT per 1M TOK)</span>
  1132→                                      )}
  1133→                                      {supportsThinking && (
  1134→                                        <span className="text-[8px] font-black text-text-tertiary/40 uppercase tracking-widest w-20 text-right">REASONING</span>
  1135→                                      )}
  1136→                                      <div className="w-6" /> {/* Spacer for delete button */}
  1137→                                    </div>
  1138→                                  )}
  1139→                                  <div
  1140→                                    ref={containerRef}
  1141→                                    className="flex flex-col gap-0.5 min-h-[50px]"
  1142→                                  >
  1143→                                    {models.map((model, index) => {
  1144→                                      const { baseModel, level } = parseModelLevel(model);
  1145→                                      // Use baseModel for pricing lookup since pricing is stored by base model name
  1146→                                      const pricing = isOpenRouter && config?.model_pricing?.['openrouter']?.[cap]?.[baseModel];
  1147→
  1148→                                      return (
  1149→                                        <div
  1150→                                          key={model}
  1151→                                          ref={el => { itemRefs.current[index] = el; }}
  1152→                                          className={clsx(
  1153→                                            "flex items-center justify-between px-2 py-1 border-b border-border/5 group transition-all relative select-none gap-2",
  1154→                                            isDragging && dragSourceIndex === index && "opacity-50",
  1155→                                            isDragging && dragTargetIndex === index && dragSourceIndex !== index && "border-t border-accent"
  1156→                                          )}
  1157→                                        >
  1158→                                          {/* Drag handle */}
  1159→                                          <div
  1160→                                            className="text-text-tertiary/20 hover:text-accent transition-all cursor-grab active:cursor-grabbing p-1 -m-1 touch-none shrink-0"
  1161→                                            onPointerDown={(e) => handlePointerDown(e, index)}
  1162→                                            onPointerMove={handlePointerMove}
  1163→                                            onPointerUp={handlePointerUp}
  1164→                                            onPointerCancel={handlePointerUp}
  1165→                                          >
  1166→                                            <span className="text-[8px] font-black">{index === 0 ? '@' : '#'}</span>
  1167→                                          </div>
  1168→
  1169→                                          {/* Model name */}
  1170→                                          <div className="flex-1 min-w-0">
  1171→                                            <span className={clsx(
  1172→                                              "text-[10px] transition-colors truncate font-mono uppercase block",
  1173→                                              index === 0 ? "text-accent font-black" : "text-text-primary/60 group-hover:text-text-primary"
  1174→                                            )}>/{baseModel}</span>
  1175→                                          </div>
  1176→
  1177→                                          {/* Pricing column for OpenRouter */}
  1178→                                          {isOpenRouter && (
  1179→                                            <div className="text-[9px] text-text-tertiary/60 font-mono text-right shrink-0 w-24">
  1180→                                              {pricing ? (
  1181→                                                <span>${pricing.prompt.toFixed(2)}/${pricing.completion.toFixed(2)}</span>
  1182→                                              ) : (
  1183→                                                <span className="text-text-tertiary/20">—</span>
  1184→                                              )}
  1185→                                            </div>
  1186→                                          )}
  1187→
  1188→                                          {/* Reasoning level dropdown */}
  1189→                                          {supportsThinking && (
  1190→                                            <select
  1191→                                              value={level}
  1192→                                              onChange={(e) => handleUpdateModelLevel(model, e.target.value as typeof level)}
  1193→                                              className={clsx(
  1194→                                                "bg-transparent border px-1.5 py-0.5 text-[9px] font-black uppercase cursor-pointer transition-all shrink-0 w-20",
  1195→                                                level
  1196→                                                  ? "text-status-success border-status-success/30 bg-status-success/5"
  1197→                                                  : "text-text-tertiary/50 border-border/20 hover:border-border/40"
  1198→                                              )}
  1199→                                              style={{ WebkitAppearance: 'none', appearance: 'none', paddingRight: '16px', backgroundImage: 'url("data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 24 24%27 stroke=%27%23666%27%3e%3cpath stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%272%27 d=%27M19 9l-7 7-7-7%27/%3e%3c/svg%3e")', backgroundRepeat: 'no-repeat', backgroundPosition: 'right 2px center', backgroundSize: '10px' }}
  1200→                                            >
  1201→                                              {reasoningLevels.map(l => (
  1202→                                                <option key={l.value} value={l.value}>{l.label}</option>
  1203→                                              ))}
  1204→                                            </select>
  1205→                                          )}
  1206→
  1207→                                          {/* Remove button */}
  1208→                                          <button
  1209→                                            onClick={(e) => {
  1210→                                              e.stopPropagation();
  1211→                                              setEditingCapability(cap);
  1212→                                              handleRemoveModel(model);
  1213→                                            }}
  1214→                                            className="text-text-tertiary/20 hover:text-status-error opacity-0 group-hover:opacity-100 transition-all text-[10px] font-black shrink-0"
  1215→                                          >
  1216→                                            [X]
  1217→                                          </button>
  1218→                                        </div>
  1219→                                      );
  1220→                                    })}
  1221→
  1222→                                    {/* Inline Add Model Input */}
  1223→                                    <div className="flex gap-2 group/input mt-1">
  1224→                                      <div className="flex-1 relative">
  1225→                                        <input
  1226→                                          type="text"
  1227→                                          placeholder={`+ ADD_NODE...`}
  1228→                                          value={isEditing ? newModelName : ''}
  1229→                                          onFocus={() => setEditingCapability(cap)}
  1230→                                          onChange={(e) => {
  1231→                                            setEditingCapability(cap);
  1232→                                            setNewModelName(e.target.value);
  1233→                                          }}
  1234→                                          onKeyDown={(e) => e.key === 'Enter' && handleAddModel()}
  1235→                                          className="w-full bg-transparent border-b border-dashed border-border/20 px-0 py-0.5 text-[10px] text-text-primary placeholder:text-text-tertiary/20 focus:outline-none focus:border-accent/40 focus:border-solid font-mono transition-all uppercase"
  1236→                                        />
  1237→                                      </div>
  1238→                                      {isEditing && newModelName.trim() && (
  1239→                                        <button
  1240→                                          onClick={handleAddModel}
  1241→                                          className="text-accent text-[10px] font-black"
  1242→                                        >
  1243→                                          [+]
  1244→                                        </button>
  1245→                                      )}
  1246→                                    </div>
  1247→                                  </div>
  1248→                                </div>
  1249→                              );
  1250→                            })}
  1251→                          </div>
  1252→                        </div>
  1253→                      )}
  1254→                    </div>
  1255→                  </div>
  1256→                </section>
  1257→              </div>
  1258→            )}
  1259→
  1260→            {activeTab === 'general' && (
  1261→              <div className="space-y-12 animate-in fade-in slide-in-from-bottom-2 duration-300 font-mono">
  1262→                {/* Appearance Section */}
  1263→                <section className="space-y-3">
  1264→                  <div className="flex flex-col gap-0.5">
  1265→                    <div className="flex items-center justify-between">
  1266→                      <div className="flex items-center gap-2 text-accent/80">
  1267→                        <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/INTERFACE_THEME</h2>
  1268→                      </div>
  1269→                    </div>
  1270→                    <p className="text-[10px] text-text-tertiary/60 italic leading-normal uppercase font-black tracking-tight">
  1271→                      VISUAL STYLES UPDATE INSTANTLY ACROSS ALL SESSIONS.
  1272→                    </p>
  1273→                  </div>
  1274→                  <div className="grid grid-cols-2 sm:grid-cols-4 gap-2.5">
  1275→                    {themes.map((t) => (
  1276→                      <button
  1277→                        key={t.id}
  1278→                        onClick={() => handleUpdateTheme(t.id)}
  1279→                        className={clsx(
  1280→                          "group relative flex flex-col p-2 border transition-all text-left h-20 active:scale-[0.98]",
  1281→                          theme === t.id
  1282→                            ? "border-accent bg-accent/5 shadow-[0_0_15px_rgba(var(--accent),0.05)]"
  1283→                            : "border-border/10 hover:border-accent/40 bg-surface/5"
  1284→                        )}
  1285→                      >
  1286→                        <div className={clsx("w-full flex-1 mb-1.5 border border-border/10 overflow-hidden relative opacity-60", t.colors)}>
  1287→                          <div className="absolute top-0 left-0 w-full h-1 bg-surface/20 border-b border-border/10" />
  1288→                          <div className={clsx("absolute bottom-1 right-1 w-2 h-2 rounded-full", t.accent)} />
  1289→                        </div>
  1290→                        <div className="flex items-center justify-between font-mono">
  1291→                          <span className={clsx(
  1292→                            "text-[10px] font-black uppercase tracking-widest",
  1293→                            theme === t.id ? "text-accent" : "text-text-tertiary/60 group-hover:text-text-secondary"
  1294→                          )}>
  1295→                            {theme === t.id ? `[${t.name}]` : `  ${t.name}`}
  1296→                          </span>
  1297→                        </div>
  1298→                      </button>
  1299→                    ))}
  1300→                  </div>
  1301→                </section>
  1302→
  1303→                <div className="grid grid-cols-1 gap-12">
  1304→                  {/* Agent Behavior Section */}
  1305→                  <section className="space-y-3">
  1306→                    <div className="flex flex-col gap-0.5">
  1307→                      <div className="flex items-center gap-2 text-accent/80">
  1308→                        <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/BEHAVIOR_CORE</h2>
  1309→                      </div>
  1310→                      <p className="text-[10px] text-text-tertiary/60 italic leading-normal uppercase font-black tracking-tight">
  1311→                        GLOBAL EXECUTION AND MEMORY POLICIES.
  1312→                      </p>
  1313→                    </div>
  1314→
  1315→                    <div className="bg-surface/5 border border-border/10 p-4 space-y-3 font-mono">
  1316→                      <div className="flex items-center justify-between border-b border-border/5 pb-3">
  1317→                        <div className="flex flex-col gap-0.5">
  1318→                          <div className="flex items-center gap-2">
  1319→                            <span className="text-[11px] font-black text-text-primary uppercase tracking-[0.2em]">/AUTO_COMPACTION</span>
  1320→                          </div>
  1321→                          <p className="text-[10px] text-text-tertiary/60 italic px-3 leading-normal font-black uppercase tracking-tight">
  1322→                            REDUCE TOKEN OVERHEAD AUTOMATICALLY AT THRESHOLD.
  1323→                          </p>
  1324→                        </div>
  1325→                        <button
  1326→                          onClick={handleToggleAutoCompaction}
  1327→                          className={clsx(
  1328→                            "text-[10px] font-black px-2 py-1 transition-all tracking-widest uppercase active:scale-95",
  1329→                            config?.agent?.auto_compaction_enabled !== false
  1330→                              ? "text-status-success hover:bg-status-success/5"
  1331→                              : "text-status-error hover:bg-status-error/5"
  1332→                          )}
  1333→                        >
  1334→                          {config?.agent?.auto_compaction_enabled !== false ? '[ACTIVE]' : '[INACTIVE]'}
  1335→                        </button>
  1336→                      </div>
  1337→                    </div>
  1338→                  </section>
  1339→
  1340→                  {/* Sub-Agent Ecosystem */}
  1341→                  <section className="space-y-4">
  1342→                    <div className="flex flex-col gap-0.5">
  1343→                      <div className="flex items-center justify-between">
  1344→                        <div className="flex items-center gap-2 text-accent/80">
  1345→                          <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/SUB_AGENTS</h2>
  1346→                        </div>
  1347→                        <button
  1348→                          onClick={handleToggleSubAgentsGlobal}
  1349→                          className={clsx(
  1350→                            "text-[10px] font-black px-2 py-0.5 transition-all tracking-widest uppercase border active:scale-95 font-mono",
  1351→                            config?.sub_agent?.enabled
  1352→                              ? "text-status-success border-status-success/20 hover:bg-status-success/5"
  1353→                              : "text-status-error border-status-error/20 hover:bg-status-error/5"
  1354→                          )}
  1355→                        >
  1356→                          {config?.sub_agent?.enabled ? '[MASTER_ON]' : '[MASTER_OFF]'}
  1357→                        </button>
  1358→                      </div>
  1359→                      <p className="text-[10px] text-text-tertiary/60 italic leading-normal uppercase font-black tracking-tight">
  1360→                        AUTONOMOUS CHILD-NODES FOR SPECIALIZED TASK PROCESSING.
  1361→                      </p>
  1362→                    </div>
  1363→
  1364→                    <div className={clsx(
  1365→                      "flex flex-col gap-4 transition-opacity duration-300 font-mono",
  1366→                      !config?.sub_agent?.enabled && "opacity-30 pointer-events-none grayscale"
  1367→                    )}>
  1368→                      {/* Configuration Controls */}
  1369→                      <div className="flex flex-col gap-4">
  1370→
  1371→
  1372→                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  1373→                          {/* Claude Code */}
  1374→                          <div className="bg-surface/5 border border-border/10 p-4 space-y-3">
  1375→                            <div className="flex items-center justify-between">
  1376→                              <div className="flex items-center gap-2">
  1377→                                <span className="text-[11px] font-black uppercase tracking-widest text-text-primary">/CLAUDE_CODE</span>
  1378→                                {status?.components?.claude === 'ok' && status?.auth?.claude?.startsWith('ok') && (
  1379→                                  <span className="text-[8px] font-black text-status-success uppercase">[READY]</span>
  1380→                                )}
  1381→                              </div>
  1382→                              <button
  1383→                                onClick={() => handleToggleCLIEnabled('claude_code')}
  1384→                                className={clsx(
  1385→                                  "text-[9px] font-black px-1.5 py-0.5 transition-all border active:scale-95",
  1386→                                  config?.sub_agent?.claude_code?.enabled
  1387→                                    ? "text-status-success border-status-success/20 hover:bg-status-success/5"
  1388→                                    : "text-text-tertiary/40 border-border/10 hover:text-text-secondary"
  1389→                                )}
  1390→                              >
  1391→                                {config?.sub_agent?.claude_code?.enabled ? '[ON]' : '[OFF]'}
  1392→                              </button>
  1393→                            </div>
  1394→
  1395→                            <div className="space-y-3">
  1396→                              <div className="space-y-1">
  1397→                                <label className="text-[9px] font-black text-text-tertiary/40 uppercase tracking-widest ml-1">/TOOLS</label>
  1398→                                <input
  1399→                                  type="text"
  1400→                                  defaultValue={config?.sub_agent?.claude_code?.allowed_tools?.join(', ')}
  1401→                                  onBlur={(e) => handleUpdateClaudeTools(e.target.value)}
  1402→                                  placeholder="Edit, Bash, Read..."
  1403→                                  className="w-full bg-transparent border-b border-border/10 px-0 py-1 text-[10px] text-text-primary focus:outline-none focus:border-accent/40 font-mono transition-all uppercase"
  1404→                                />
  1405→                              </div>
  1406→                            </div>
  1407→                          </div>
  1408→
  1409→                          {/* Codex */}
  1410→                          <div className="bg-surface/5 border border-border/10 p-4 space-y-3">
  1411→                            <div className="flex items-center justify-between">
  1412→                              <div className="flex items-center gap-2">
  1413→                                <span className="text-[11px] font-black uppercase tracking-widest text-text-primary">/CODEX</span>
  1414→                                {status?.components?.codex === 'ok' && status?.auth?.codex?.startsWith('ok') && (
  1415→                                  <span className="text-[8px] font-black text-status-success uppercase">[READY]</span>
  1416→                                )}
  1417→                              </div>
  1418→                              <button
  1419→                                onClick={() => handleToggleCLIEnabled('codex')}
  1420→                                className={clsx(
  1421→                                  "text-[9px] font-black px-1.5 py-0.5 transition-all border active:scale-95",
  1422→                                  config?.sub_agent?.codex?.enabled
  1423→                                    ? "text-status-success border-status-success/20 hover:bg-status-success/5"
  1424→                                    : "text-text-tertiary/40 border-border/10 hover:text-text-secondary"
  1425→                                )}
  1426→                              >
  1427→                                {config?.sub_agent?.codex?.enabled ? '[ON]' : '[OFF]'}
  1428→                              </button>
  1429→                            </div>
  1430→
  1431→                            <div className="space-y-3">
  1432→                              <div className="space-y-1">
  1433→                                <label className="text-[9px] font-black text-text-tertiary/40 uppercase tracking-widest ml-1">/APPROVAL</label>
  1434→                                <div className="flex gap-1">
  1435→                                  {['untrusted', 'on-failure', 'on-request', 'never'].map((mode) => (
  1436→                                    <button
  1437→                                      key={mode}
  1438→                                      onClick={() => handleUpdateCodexMode(mode)}
  1439→                                      className={clsx(
  1440→                                        "flex-1 py-1 text-[8px] font-black uppercase border transition-all active:scale-95",
  1441→                                        config?.sub_agent?.codex?.approval_mode?.toLowerCase() === mode.toLowerCase()
  1442→                                          ? "text-accent border-accent/40 bg-accent/5"
  1443→                                          : "border-border/10 text-text-tertiary/40 hover:text-text-secondary hover:bg-surface/5"
  1444→                                      )}
  1445→                                    >
  1446→                                      {config?.sub_agent?.codex?.approval_mode?.toLowerCase() === mode.toLowerCase() 
  1447→                                        ? `[${mode.toUpperCase().replace('-', '_')}]` 
  1448→                                        : mode.toUpperCase().replace('-', '_')}
  1449→                                    </button>
  1450→                                  ))}
  1451→                                </div>
  1452→                              </div>
  1453→                            </div>
  1454→                          </div>
  1455→                        </div>
  1456→                      </div>
  1457→                    </div>
  1458→                  </section>
  1459→                </div>
  1460→              </div>
  1461→            )
  1462→            }
  1463→
  1464→            {activeTab === 'security' && (
  1465→              <div className="space-y-12 animate-in fade-in slide-in-from-bottom-2 duration-300 font-mono">
  1466→                {/* Unrestricted Execution Mode Toggle */}
  1467→                <div className={clsx(
  1468→                  "p-4 border transition-all duration-500",
  1469→                  config?.security?.always_allow_all
  1470→                    ? "bg-status-error text-background border-status-error shadow-[0_0_25px_rgba(var(--status-error),0.2)]"
  1471→                    : "bg-status-error/5 border-status-error/10"
  1472→                )}>
  1473→                  <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
  1474→                    <div className="flex flex-col gap-1 pr-4">
  1475→                      <div className="flex items-center gap-2">
  1476→                        <span className={clsx(
  1477→                          "text-[11px] font-black uppercase tracking-[0.2em]",
  1478→                          config?.security?.always_allow_all ? "text-background" : "text-status-error"
  1479→                        )}>/UNRESTRICTED_EXECUTION</span>
  1480→                        {config?.security?.always_allow_all && (
  1481→                          <span className="text-[8px] font-black bg-background text-status-error px-1 py-0.5 animate-pulse tracking-widest">[SYSTEM_UNLOCKED]</span>
  1482→                        )}
  1483→                      </div>
  1484→                      <p className={clsx(
  1485→                        "text-[9px] italic leading-relaxed max-w-2xl font-black uppercase tracking-tight",
  1486→                        config?.security?.always_allow_all ? "text-background/90" : "text-text-tertiary/60"
  1487→                      )}>
  1488→                        BYPASS_ALL_SECURITY_CHECKS. AGENTS GAIN FULL UNMONITORED SYSTEM ACCESS. USE ONLY IN TRUSTED ENVIRONMENTS.
  1489→                      </p>
  1490→                    </div>
  1491→                    <button
  1492→                      onClick={handleToggleAlwaysAllowAll}
  1493→                      className={clsx(
  1494→                        "text-[9px] font-black px-3 py-1.5 transition-all tracking-[0.1em] uppercase border whitespace-nowrap active:scale-95",
  1495→                        config?.security?.always_allow_all
  1496→                          ? "bg-background text-status-error border-background"
  1497→                          : "bg-status-error text-background border-status-error"
  1498→                      )}
  1499→                    >
  1500→                      {config?.security?.always_allow_all ? '[RESTORE_SECURITY]' : '[DISABLE_SECURITY]'}
  1501→                    </button>
  1502→                  </div>
  1503→                </div>
  1504→
  1505→                {/* Shell Execution Policy */}
  1506→                <section className={clsx(
  1507→                  "space-y-3 transition-all duration-300",
  1508→                  config?.security?.always_allow_all && "opacity-40 grayscale"
  1509→                )}>
  1510→                  <div className="flex flex-col gap-0.5">
  1511→                    <div className="flex items-center justify-between">
  1512→                      <div className="flex items-center gap-2 text-accent/80">
  1513→                        <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/SHELL_POLICY</h2>
  1514→                      </div>
  1515→                      {config?.security?.always_allow_all && (
  1516→                        <span className="text-[8px] font-black text-status-error uppercase tracking-widest bg-status-error/10 px-1.5 py-0.5">
  1517→                          [OVERRIDDEN_BY_UNRESTRICTED_MODE]
  1518→                        </span>
  1519→                      )}
  1520→                    </div>
  1521→                    <p className="text-[10px] text-text-tertiary/60 italic leading-normal uppercase font-black tracking-tight">
  1522→                      CONTROL AUTO-APPROVAL LEVELS FOR TERMINAL COMMANDS.
  1523→                    </p>
  1524→                  </div>
  1525→
  1526→                  <div className={clsx(
  1527→                    "bg-surface/5 border border-border/10 p-5 space-y-4",
  1528→                    config?.security?.always_allow_all && "pointer-events-none"
  1529→                  )}>
  1530→                    <div className="flex flex-col gap-0.5">
  1531→                      <span className="text-[11px] font-black text-text-primary uppercase tracking-[0.2em]">/EXECUTION_MODE</span>
  1532→                    </div>
  1533→
  1534→                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
  1535→                      {[
  1536→                        { id: 'restricted', label: 'RESTRICTED', desc: 'Minimal safe set' },
  1537→                        { id: 'read-only', label: 'READ_ONLY', desc: 'All inspections' },
  1538→                        { id: 'non-destructive', label: 'MUTABLE', desc: 'No deletions' },
  1539→                        { id: 'unrestricted', label: 'OPEN', desc: 'No approvals' },
  1540→                      ].map((mode) => (
  1541→                        <button
  1542→                          key={mode.id}
  1543→                          onClick={() => handleUpdateShellPermissionMode(mode.id)}
  1544→                          className={clsx(
  1545→                            "flex flex-col items-start p-3 border transition-all text-left group active:scale-[0.98]",
  1546→                            config?.security?.shell_permission_mode === mode.id
  1547→                              ? "border-accent bg-accent/5 shadow-[0_0_15px_rgba(var(--accent),0.05)]"
  1548→                              : "border-border/10 hover:border-accent/40 bg-surface/5"
  1549→                          )}
  1550→                        >
  1551→                          <span className={clsx(
  1552→                            "text-[10px] font-black uppercase tracking-widest mb-1",
  1553→                            config?.security?.shell_permission_mode === mode.id ? "text-accent" : "text-text-tertiary/60 group-hover:text-text-secondary"
  1554→                          )}>
  1555→                            {config?.security?.shell_permission_mode === mode.id ? `[${mode.label}]` : `  ${mode.label}`}
  1556→                          </span>
  1557→                          <span className="text-[8px] text-text-tertiary/40 font-black uppercase leading-tight">
  1558→                            {mode.desc}
  1559→                          </span>
  1560→                        </button>
  1561→                      ))}
  1562→                    </div>
  1563→                  </div>
  1564→                </section>
  1565→
  1566→                {/* Vault Section */}
  1567→                <section className="space-y-3">
  1568→                  <div className="flex flex-col gap-0.5">
  1569→                    <div className="flex items-center gap-2 text-accent/80">
  1570→                      <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/SECURE_VAULT</h2>
  1571→                    </div>
  1572→                    <p className="text-[10px] text-text-tertiary/60 italic leading-normal uppercase font-black tracking-tight">
  1573→                      PROTECTED TOKENS AND ENVIRONMENT VARIABLES.
  1574→                    </p>
  1575→                  </div>
  1576→
  1577→                  <div className="bg-surface/5 border border-border/10 p-5 space-y-6">
  1578→                    <div className="space-y-4">
  1579→                      <div className="flex flex-col gap-0.5">
  1580→                        <span className="text-[11px] font-black text-text-primary uppercase tracking-[0.2em]">/VAULT_INDEX</span>
  1581→                        <p className="text-[10px] text-text-tertiary/60 italic px-3 font-black uppercase tracking-tight">
  1582→                          ACCESS IN TOOLS VIA <code className="text-accent underline">{"{{vault:KEY}}"}</code>.
  1583→                        </p>
  1584→                      </div>
  1585→
  1586→                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
  1587→                        {vaultSecrets && vaultSecrets.length > 0 ? (
  1588→                          vaultSecrets.map((secret: any) => (
  1589→                            <div
  1590→                              key={secret.name}
  1591→                              className="flex items-center justify-between px-3 py-1.5 bg-background/20 border border-border/5 group hover:border-accent/20 transition-all"
  1592→                            >
  1593→                              <div className="flex items-center gap-2">
  1594→                                <span className="text-[8px] font-black text-accent/40 uppercase">[KEY]</span>
  1595→                                <span className="text-[11px] font-black text-text-primary/70 font-mono truncate max-w-[120px]">
  1596→                                  /{secret.name}
  1597→                                </span>
  1598→                              </div>
  1599→                              <button
  1600→                                onClick={() => handleRemoveVaultSecret(secret.name)}
  1601→                                className="text-text-tertiary/20 hover:text-status-error opacity-0 group-hover:opacity-100 transition-all text-[10px] font-black"
  1602→                              >
  1603→                                [X]
  1604→                              </button>
  1605→                            </div>
  1606→                          ))
  1607→                        ) : (
  1608→                          <div className="col-span-full py-6 border border-dashed border-border/10 flex flex-col items-center justify-center text-text-tertiary/20">
  1609→                            <span className="text-[9px] uppercase font-black tracking-[0.2em]">[VAULT_NULL]</span>
  1610→                          </div>
  1611→                        )}
  1612→                      </div>
  1613→
  1614→                      {/* Add Secret Form */}
  1615→                      <div className="mt-4 p-4 border-t border-border/5 space-y-3">
  1616→                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
  1617→                          <div className="space-y-1">
  1618→                            <label className="text-[9px] font-black text-text-tertiary/40 uppercase tracking-widest ml-1">/KEY</label>
  1619→                            <input
  1620→                              type="text"
  1621→                              placeholder="GITHUB_TOKEN..."
  1622→                              value={newVaultSecret.name}
  1623→                              onChange={(e) => setNewVaultSecret(prev => ({ ...prev, name: e.target.value.toUpperCase().replace(/[^A-Z0-9_]/g, '_') }))}
  1624→                              className="w-full bg-transparent border-b border-border/10 px-0 py-1 text-[11px] text-text-primary focus:outline-none focus:border-accent/40 font-mono transition-all uppercase"
  1625→                            />
  1626→                          </div>
  1627→                          <div className="space-y-1">
  1628→                            <label className="text-[9px] font-black text-text-tertiary/40 uppercase tracking-widest ml-1">/VALUE</label>
  1629→                            <input
  1630→                              type="password"
  1631→                              placeholder="ENCRYPTED..."
  1632→                              value={newVaultSecret.value}
  1633→                              onChange={(e) => setNewVaultSecret(prev => ({ ...prev, value: e.target.value }))}
  1634→                              className="w-full bg-transparent border-b border-border/10 px-0 py-1 text-[11px] text-text-primary focus:outline-none focus:border-accent/40 font-mono transition-all"
  1635→                            />
  1636→                          </div>
  1637→                        </div>
  1638→                        <button
  1639→                          onClick={handleSetVaultSecret}
  1640→                          disabled={isSaving || !newVaultSecret.name || !newVaultSecret.value}
  1641→                          className="w-full py-1 text-accent hover:text-accent-hover font-black text-[10px] uppercase tracking-widest transition-all disabled:opacity-20 active:scale-[0.98]"
  1642→                        >
  1643→                          [STORE_IN_VAULT]
  1644→                        </button>
  1645→                      </div>
  1646→                    </div>
  1647→                  </div>
  1648→                </section>
  1649→              </div>
  1650→            )
  1651→            }
  1652→
  1653→            {activeTab === 'shortcuts' && (
  1654→              <div className="space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-300 font-mono">
  1655→                {/* All Hotkeys Section */}
  1656→                <section className="space-y-3">
  1657→                  <div className="flex flex-col gap-0.5">
  1658→                    <div className="flex items-center gap-2 text-accent/80">
  1659→                      <h2 className="text-[12px] font-black uppercase tracking-[0.2em]">/SHORTCUTS</h2>
  1660→                    </div>
  1661→                  </div>
  1662→
  1663→                  <div className="bg-surface/5 border border-border/10 p-5">
  1664→                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1">
  1665→                      {Object.entries(hotkeyLabels).map(([key, label]) => (
  1666→                        <div key={key} className="flex items-center justify-between py-1.5 border-b border-border/5 last:border-0 md:[&:nth-last-child(-n+2)]:border-0">
  1667→                          <span className="text-[10px] font-black text-text-tertiary/60 uppercase tracking-widest">/{label.toUpperCase().replace(/ /g, '_').replace(/[()]/g, '')}</span>
  1668→                          <button
  1669→                            onClick={() => setRecordingHotkey(key)}
  1670→                            className={clsx(
  1671→                              "font-mono text-[10px] font-black transition-all min-w-[90px] text-right",
  1672→                              recordingHotkey === key
  1673→                                ? "text-accent animate-pulse"
  1674→                                : "text-accent/60 hover:text-accent"
  1675→                            )}
  1676→                          >
  1677→                            {recordingHotkey === key ? '[REC...]' : `[${((config?.ui as any)?.hotkeys?.[key] || hotkeyDefaults[key] || 'N/A').toUpperCase()}]`}
  1678→                          </button>
  1679→                        </div>
  1680→                      ))}
  1681→                    </div>
  1682→                        <div className="mt-6 pt-3 border-t border-border/5">
  1683→                      <p className="text-[9px] text-text-tertiary/20 uppercase tracking-tighter italic font-black">
  1684→                        [ESCAPE_TO_CANCEL] // SYSTEM_RESERVED_KEYS_OVERRIDE
  1685→                      </p>
  1686→                    </div>
  1687→                  </div>
  1688→                </section>
  1689→              </div>
  1690→            )
  1691→            }
  1692→          </div >
  1693→        </div >
  1694→      </div >
  1695→    </div >
  1696→  );
  1697→};
  1698→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
